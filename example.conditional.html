<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="scripts/riven.js"></script>
  <script src="scripts/nodes/bang.js"></script>
  <link rel="stylesheet" type="text/css" href="links/reset.css"/>
  <link rel="stylesheet" type="text/css" href="links/fonts.css"/>
  <link rel="stylesheet" type="text/css" href="links/main.css"/>
  <title>Riven</title>
</head>
<body>
  <script>
    'use strict'

    RIVEN.lib.Hash = function(id,rect)
    {
      RIVEN.Node.call(this,id,rect);
      this.glyph = "M60,150 L60,150 L240,150 L240,150 L150,240 M150,60 L150,60 L240,150"

      this.receive = function()
      {
        var hash = window.location.hash.substring(1).replace(/[^0-9a-z]/gi," ").trim().toLowerCase()
        this.label = hash ? "hash="+hash : "Add hash to url"
        this.send(hash)
      }
    }

    RIVEN.lib.Choice = function(id,rect)
    {
      RIVEN.Node.call(this,id,rect);
      this.glyph = "M60,120 L60,120 L150,120 L240,60 M60,150 L60,150 L240,150 M60,180 L60,180 L150,180 L240,240"

      this.receive = function(q)
      {
        var signal = this.signal(q)
        if(signal){
          signal.receive()
        }
        else{
          this.signal("else").receive()
        }
      }
    }

    RIVEN.lib.Value = function(id,rect,param)
    {
      RIVEN.Node.call(this,id,rect);
      this.glyph = "M60,60 L60,60 L240,60 L240,240 L60,240 Z M60,150 L60,150 L240,150"
      this.label = param
      this.param = param

      this.answer = function()
      {
        return this.param
      }
    }

    RIVEN.lib.Print = function(id,rect)
    {
      RIVEN.Node.call(this,id,rect);
      this.glyph = "M60,60 L60,60 L240,60 L240,240 L60,240 Z M240,150 L240,150 L150,150 L150,240"
      this.label = ""

      this.receive = function(q)
      {
        this.label = "true";
      }
    }

    RIVEN.lib.Add = function(id,rect)
    {
      RIVEN.Node.call(this,id,rect);
      this.glyph = "M60,60 L60,60 L240,60 M60,120 L60,120 L240,120 M60,180 L60,180 L240,180 M60,240 L60,240 L240,240"
      this.label = "add"

      this.add = function()
      {
        var sum = 0;
        var values = this.request();
        for(id in values){
          sum += values[id];
        }
        return sum
      }

      this.receive = function(q)
      {
        this.send(this.add())
      }

      this.answer = function()
      {
        return this.add()
      }
    }

    // Build tree
    const lib = RIVEN.lib

    RIVEN.create = (append = true) => {
      Ø("bang").create({x:2,y:4},lib.Bang)
      Ø("hash").create({x:6,y:4},lib.Hash)
      Ø("print_red").create({x:30,y:2},lib.Print)
      Ø("print_green").create({x:30,y:6},lib.Print)
      Ø("print_blue").create({x:30,y:10},lib.Print)
      Ø("print_else").create({x:30,y:14},lib.Print)

      Ø("example").mesh({x:10,y:0},[
        Ø("choice").create({x:4,y:8},lib.Choice),
        Ø("red").create({x:12,y:2},lib.Value,"red"),
        Ø("green").create({x:12,y:6},lib.Value,"green"),
        Ø("blue").create({x:12,y:10},lib.Value,"blue"),
        Ø("else").create({x:12,y:14},lib.Value,"else"),
      ])

      Ø("bang").connect("hash")
      Ø("hash").connect("choice")
      Ø("choice").connect(["red","green","blue","else"])
      Ø("red").connect("print_red")
      Ø("green").connect("print_green")
      Ø("blue").connect("print_blue")
      Ø("else").connect("print_else")
      Ø("bang").bang()
    }

    RIVEN.create(true);
    RIVEN.graph()
  </script>
</body>
</html>
